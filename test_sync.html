<!DOCTYPE html>
<html>
<head>
    <title>–¢–µ—Å—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏</title>
    <style>
        body { font-family: Arial; margin: 20px; background: #f0f0f0; }
        .test { background: white; padding: 20px; margin: 10px 0; border-radius: 8px; }
        button { padding: 10px 20px; margin: 5px; }
        .messages { background: #eee; padding: 10px; min-height: 100px; }
    </style>
</head>
<body>
    <h1>üîÑ –¢–µ—Å—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫–∞</h1>
    
    <div class="test">
        <h3>–®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–¥ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏</h3>
        <input type="text" id="syncCode" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä: test123)">
        <button onclick="setSyncCode()">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
        <button onclick="clearSyncCode()">–û—á–∏—Å—Ç–∏—Ç—å</button>
    </div>
    
    <div class="test">
        <h3>–®–∞–≥ 2: –î–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</h3>
        <input type="text" id="messageText" placeholder="–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è">
        <button onclick="addMessage()">–î–æ–±–∞–≤–∏—Ç—å</button>
    </div>
    
    <div class="test">
        <h3>–®–∞–≥ 3: –°–æ–æ–±—â–µ–Ω–∏—è (–¥–æ–ª–∂–Ω—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è)</h3>
        <div class="messages" id="messages"></div>
        <button onclick="loadMessages()">–û–±–Ω–æ–≤–∏—Ç—å</button>
    </div>
    
    <div class="test">
        <h3>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</h3>
        <ol>
            <li>–û—Ç–∫—Ä–æ–π—Ç–µ —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ –¥–≤—É—Ö –≤–∫–ª–∞–¥–∫–∞—Ö</li>
            <li>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –∫–æ–¥ –≤ –æ–±–µ–∏—Ö –≤–∫–ª–∞–¥–∫–∞—Ö</li>
            <li>–î–æ–±–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –æ–¥–Ω–æ–π –≤–∫–ª–∞–¥–∫–µ</li>
            <li>–ù–∞–∂–º–∏—Ç–µ "–û–±–Ω–æ–≤–∏—Ç—å" –≤ –¥—Ä—É–≥–æ–π –≤–∫–ª–∞–¥–∫–µ - —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è</li>
        </ol>
    </div>

    <script>
        let currentSyncCode = null;

        function setSyncCode() {
            const code = document.getElementById('syncCode').value.trim();
            if (code.length < 3) {
                alert('–ö–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞');
                return;
            }
            
            currentSyncCode = code;
            localStorage.setItem('test-sync-code', code);
            alert('–ö–æ–¥ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: ' + code);
            loadMessages();
        }

        function clearSyncCode() {
            currentSyncCode = null;
            localStorage.removeItem('test-sync-code');
            alert('–ö–æ–¥ –æ—á–∏—â–µ–Ω');
            document.getElementById('messages').innerHTML = '';
        }

        function addMessage() {
            if (!currentSyncCode) {
                alert('–°–Ω–∞—á–∞–ª–∞ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–æ–¥ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏');
                return;
            }
            
            const text = document.getElementById('messageText').value.trim();
            if (!text) {
                alert('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è');
                return;
            }
            
            const message = {
                id: Date.now(),
                text: text,
                timestamp: new Date().toLocaleTimeString(),
                device: '–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ ' + Math.random().toString(36).substr(2, 3)
            };
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
            let messages = [];
            try {
                const sharedKey = 'translator_shared_' + currentSyncCode;
                const sharedData = localStorage.getItem(sharedKey);
                if (sharedData) {
                    const parsed = JSON.parse(sharedData);
                    messages = parsed.messages || [];
                }
            } catch (e) {}
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            messages.push(message);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º
            const sharedData = {
                messages: messages,
                lastUpdate: new Date().toISOString()
            };
            
            const sharedKey = 'translator_shared_' + currentSyncCode;
            localStorage.setItem(sharedKey, JSON.stringify(sharedData));
            
            document.getElementById('messageText').value = '';
            loadMessages();
            
            // –£–≤–µ–¥–æ–º–ª—è–µ–º –¥—Ä—É–≥–∏–µ –≤–∫–ª–∞–¥–∫–∏
            window.dispatchEvent(new StorageEvent('storage', {
                key: sharedKey,
                newValue: JSON.stringify(sharedData)
            }));
        }

        function loadMessages() {
            if (!currentSyncCode) return;
            
            try {
                const sharedKey = 'translator_shared_' + currentSyncCode;
                const sharedData = localStorage.getItem(sharedKey);
                
                if (sharedData) {
                    const parsed = JSON.parse(sharedData);
                    const messages = parsed.messages || [];
                    
                    const html = messages.map(msg => 
                        `<div style="margin: 5px 0; padding: 8px; background: #ddd; border-radius: 4px;">
                            <strong>${msg.timestamp}</strong> - ${msg.text} <small>(${msg.device})</small>
                        </div>`
                    ).join('');
                    
                    document.getElementById('messages').innerHTML = html || '–°–æ–æ–±—â–µ–Ω–∏–π –Ω–µ—Ç';
                } else {
                    document.getElementById('messages').innerHTML = '–°–æ–æ–±—â–µ–Ω–∏–π –Ω–µ—Ç';
                }
            } catch (e) {
                document.getElementById('messages').innerHTML = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + e.message;
            }
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–¥ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        window.onload = function() {
            const savedCode = localStorage.getItem('test-sync-code');
            if (savedCode) {
                currentSyncCode = savedCode;
                document.getElementById('syncCode').value = savedCode;
                loadMessages();
            }
        };

        // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç –¥—Ä—É–≥–∏—Ö –≤–∫–ª–∞–¥–æ–∫
        window.addEventListener('storage', function(e) {
            if (e.key && e.key.startsWith('translator_shared_')) {
                loadMessages();
            }
        });
    </script>
</body>
</html>